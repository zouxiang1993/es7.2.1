# 索引生命周期管理 
索引生命周期管理(index lifecycle management, ILM) API可以随着时间变化自动管理索引。 
可以按一个固定的时间周期来对索引执行管理操作，也可以基于其他因素，例如分片大小和性能要求。
通过将生命周期策略(policy)绑定到索引模板上，你可以控制如何随着索引的老化而处理索引。
可以通过更新策略来修改 新索引和现有索引的生命周期。

对于时序索引，其生命周期有如下4个阶段: 
- hot : 索引正在活跃的更新和查询。
- warm : 索引不再更新, 但仍然有查询。
- cold : 索引不再更新, 且很少被查询。信息仍然需要可以搜索，但是查询速度慢也可以接受
- delete : 不再需要改索引，可以安全的删除它。

生命周期策略(lifecycle pollicy)控制 索引如何在这些阶段之间进行转换 以及 每个阶段对索引执行的操作。
策略可以: 
- 指定一个索引的最大大小或者最大年龄，达到之后，滚动(roll over)到一个新的索引
- 指定一个时间点，该时间点之后索引不会再更新，此时可以减少主分片的数量
- 指定何时进行强制merge，以永久删除lucene中已经被标记为删除的文档
- 指定一个时间点，该时间点之后索引可以迁移到性能较低的硬件上去
- 指定一个时间点，该时间点之后可用性不再那么重要，因此可以减少副本数量
- 指定何时可以安全的删除索引 

例如，如果你要将一组ATM的指标数据写到ES中，你可以定义如下策略：
- 当索引达到50GB时，滚动到一个新的索引
- 将旧索引转为warm阶段, 并将其标记为只读，然后将其缩小为单个shard
- 7天后，将索引转为cold阶段，并将其移动到廉价的硬件上去。
- 30天后，将索引删除。 

## 时机 
索引根据每个阶段的 min_age 参数来进入该阶段。只有当索引的年龄超过了一个阶段的 min_age，索引才会进入这个阶段。

min_age通常是从索引创建开始计时。如果索引是滚动的，那么min_age是从索引滚动时开始计时，
这样做是为了相对于最后写入数据的时间来执行后面的阶段。 

在ilm检查 min_age 并进入下一个阶段之前，索引必须完成当前阶段的操作。 
默认情况下，ilm每10分钟检查一次满足policy条件的索引，你可以使用 indices.lifecycle.poll_interval 来控制检查的频率。

## 阶段(phase)
当前阶段的定义存储在索引的元数据中。阶段和它里面的活动(action)被编译成一系列离散的步骤(step),这些步骤被顺序的执行。
某些ilm的活动很复杂，涉及到对索引的多个操作，每个操作都在一个被称为"步骤(step)"的独立单元中执行。

Explain Lifecycle API可以提供这些信息，查看索引当前在执行哪一步骤，以及下一步要执行哪一步骤。  





















